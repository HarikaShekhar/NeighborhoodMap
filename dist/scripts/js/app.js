var places={initialMap:{center:{lat:37.399072,lng:-121.920731},zoom:11,mapTypeControl:!1},mapPlaces:[{address:"690 River Oaks Pkwy, Ste A, San Jose, CA 95134",name:"Chase Bank",coordinates:{lat:37.397928,lng:-121.924195},icon:"images/bank.png",category:"banks"},{address:"Rivermark Village, 3970 Rivermark Plaza, Santa Clara, CA 95054",name:"Safeway Supermarket",coordinates:{lat:37.394924,lng:-121.94768},icon:"images/groceries.png",category:"convenience"},{address:"367 Cypress Dr, Milpitas, CA 95035",name:"Chevron Gas Station",coordinates:{lat:37.421851,lng:-121.92175},icon:"images/gas.png",category:"servicestations"},{address:"447 Great Mall Dr, Milpitas, CA 95035",name:"Great Mall",coordinates:{lat:37.41598,lng:-121.897477},icon:"images/mall.png",category:"shoppingcenters"},{address:"2000 Bart Way, Fremont, CA 94536",name:"Bart Station",coordinates:{lat:37.55764,lng:-121.9766},icon:"images/bart.png",category:"publictransport"},{address:"3331 N 1st St, San Jose, CA 95134",name:"Santa Clara VTA",coordinates:{lat:37.400609,lng:-121.940208},icon:"images/vta.png",category:"publictransport"},{address:"19980 E Homestead Rd, Cupertino, CA 95014",name:"Gochi Japanese Fusion",coordinates:{lat:37.337084,lng:-122.022773},icon:"images/food.png",category:"restaurants"},{address:"1701 Airport Blvd San Jose, CA 95110",name:"San Jose Airport",coordinates:{lat:37.364186,lng:-121.928948},icon:"images/airport.png",category:"airports"},{address:"McCarthy Ranch Marketplace, 182 Ranch Dr, Milpitas, CA 95035",name:"Banana Leaf",coordinates:{lat:37.429166,lng:-121.920085},icon:"images/food.png",category:"restaurants"},{address:"5237 Stevens Creek Blvd Santa Clara, CA 95051",name:"Chromatic Coffee",coordinates:{lat:37.323991,lng:-121.994498},icon:"images/coffee.png",category:"coffee"}],yelpSuccessMessage:function(e,a,n,o,t,s){return'<div id="content"><h2 id="heading">'+e+'</h2><div id="description">Click the button for Yelp Reviews about <em><b>'+e+'</b></em><br><div id="yelp"><p><b>Address:</b> '+a+", "+n+'</p><p>Ratings: <img src="'+o+'" alt="ratings image"/></p><img src="'+t+'" alt="image of place"/><br><br><a href="'+s+'" target="_blank"><img src="images/yelp_review_btn_red.png"/></a></div></div></div>'},yelpErrorMessage:function(e){return'<div id="content><h2 id="heading">'+e+'</h2><div id="description"><h2>Woops!</h2><p>Could not fetch information from Yelp for <em><b>'+e+"</b></em></p><p>Please check your internet connect and try again later.</p></div></div>"}},initializeMap=function(){$(".menuIcon").click(function(e){e.preventDefault(),$("#wrapper").toggleClass("toggled"),$("input").focus()}),$("button").click(function(){$("input").focus()});var e=new google.maps.Map(document.getElementById("map"),places.initialMap);infoWindow=new google.maps.InfoWindow({content:"",maxWidth:250}),ko.applyBindings(new MapViewModel(e))},googleErrorHandler=function(e){$("#map").text("Woops! Could not load Google maps. Please check your internet connection and try again."),$("#map").css({"font-style":"bold","font-size":"200%"})},MapViewModel=function(e){var a=this;a.map=e,a.inputString=ko.observable(""),a.locations=ko.observableArray([]),a.markers=[],a.compare=function(e,a){return e.name<a.name?-1:e.name>a.name?1:0},places.mapPlaces.sort(a.compare),places.mapPlaces.forEach(function(e){e.clicked=ko.observable(!1),a.locations().push(e)}),a.bounds=new google.maps.LatLngBounds,a.addMapMarkers=function(){a.locations().forEach(function(e){e.map=a.map,e.marker=new google.maps.Marker({map:e.map,position:e.coordinates,animation:google.maps.Animation.DROP,title:e.name,icon:e.icon}),a.getYelpReviews(e),a.markers.push(e.marker),a.bounds.extend(new google.maps.LatLng(e.coordinates)),e.marker.addListener("click",function(){a.displayPlaceInfo(e)})}),a.map.fitBounds(a.bounds),a.map.setCenter(a.bounds.getCenter())},a.getYelpReviews=function(e){var a={consumerKey:"XYBDe1H6mOgNCWXGfiJZaQ",consumerSecret:"AGCTqcGXajIqjABfSn4LXk4yfcY",accessToken:"2mLbAaofW3euUQE4xYSIxfveWAbKVPuU",accessTokenSecret:"BLuRQ1aZZPjgroD3tPrnMSS-RhQ",serviceProvider:{signatureMethod:"HMAC-SHA1"}},n={consumerSecret:a.consumerSecret,tokenSecret:a.accessTokenSecret},o=[];o.push(["term",e.name]),o.push(["location",e.address]),o.push(["sort",1]),o.push(["category_filter",e.category]),o.push(["callback","cb"]),o.push(["oauth_consumer_key",a.consumerKey]),o.push(["oauth_consumer_secret",a.consumerSecret]),o.push(["oauth_token",a.accessToken]),o.push(["oauth_signature_method","HMAC-SHA1"]);var t={action:"http://api.yelp.com/v2/search",method:"GET",parameters:o};OAuth.setTimestampAndNonce(t),OAuth.SignatureMethod.sign(t,n);var s=OAuth.getParameterMap(t.parameters);s.oauth_signature=OAuth.percentEncode(s.oauth_signature),$.ajax({url:t.action,data:s,cache:!0,dataType:"jsonp",timeout:2e3,error:function(){var a=places.yelpErrorMessage(e.name);e.infowindow=new google.maps.InfoWindow({content:a})}}).done(function(a){var n=a.businesses[0].location.display_address[0],o=a.businesses[0].location.display_address[1],t=a.businesses[0].rating_img_url,s=a.businesses[0].image_url,i=a.businesses[0].url,r=places.yelpSuccessMessage(e.name,n,o,t,s,i);e.infowindow=new google.maps.InfoWindow({content:r})})},a.addMapMarkers(),a.filterPlaces=function(e){a.locations.removeAll(),a.markers.forEach(function(e){e.setMap(null)}),a.markers=[];var n=a.inputString().toLowerCase();places.mapPlaces.forEach(function(e){(e.name.toLowerCase().indexOf(n)>=0||e.category.toLowerCase().indexOf(n)>=0)&&a.locations.push(e)}),a.addMapMarkers()},a.inputString.subscribe(a.filterPlaces),a.resetFilter=function(){a.inputString(""),places.mapPlaces.forEach(function(e){a.locations().push(e)}),a.bounds=new google.maps.LatLngBounds,a.locations().forEach(function(e){a.bounds.extend(new google.maps.LatLng(e.coordinates)),e.clicked(!1),e.marker.setAnimation(null),e.infowindow.close()}),a.map.fitBounds(a.bounds),a.map.setCenter(a.bounds.getCenter())},a.toggleBounce=function(e){null!==e.getAnimation()?e.setAnimation(null):e.setAnimation(google.maps.Animation.BOUNCE)},a.displayPlaceInfo=function(e){a.markers.forEach(function(a){a!=e.marker&&a.setAnimation(null)}),a.toggleBounce(e.marker),a.locations().forEach(function(a){a!=e&&a.clicked(!0)&&(a.clicked(!1),a.infowindow.close())}),e.clicked()===!0?(e.clicked(!1),e.infowindow.close()):(e.clicked(!0),e.infowindow.open(e.map,e.marker)),e.infowindow.addListener("closeclick",function(){e.clicked(!1),e.marker.setAnimation(null)}),e.map.panTo({lat:e.coordinates.lat+.1,lng:e.coordinates.lng})}};