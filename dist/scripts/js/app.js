var initializeMap=function(){var e={initialMap:{center:{lat:37.399072,lng:-121.920731},zoom:11,mapTypeControl:!1},mapPlaces:[{address:"690 River Oaks Pkwy, Ste A, San Jose, CA 95134",name:"Chase Bank",coordinates:{lat:37.397928,lng:-121.924195},icon:"images/bank.png",category:"banks"},{address:"Rivermark Village, 3970 Rivermark Plaza, Santa Clara, CA 95054",name:"Safeway Supermarket",coordinates:{lat:37.394924,lng:-121.94768},icon:"images/groceries.png",category:"convenience"},{address:"367 Cypress Dr, Milpitas, CA 95035",name:"Chevron Gas Station",coordinates:{lat:37.421851,lng:-121.92175},icon:"images/gas.png",category:"servicestations"},{address:"447 Great Mall Dr, Milpitas, CA 95035",name:"Great Mall",coordinates:{lat:37.41598,lng:-121.897477},icon:"images/mall.png",category:"shoppingcenters"},{address:"2000 Bart Way, Fremont, CA 94536",name:"Bart Station",coordinates:{lat:37.55764,lng:-121.9766},icon:"images/bart.png",category:"publictransport"},{address:"3331 N 1st St, San Jose, CA 95134",name:"Santa Clara VTA",coordinates:{lat:37.400609,lng:-121.940208},icon:"images/vta.png",category:"publictransport"},{address:"19980 E Homestead Rd, Cupertino, CA 95014",name:"Gochi Japanese Fusion",coordinates:{lat:37.337084,lng:-122.022773},icon:"images/food.png",category:"restaurants"},{address:"1701 Airport Blvd San Jose, CA 95110",name:"San Jose Airport",coordinates:{lat:37.364186,lng:-121.928948},icon:"images/airport.png",category:"airports"},{address:"McCarthy Ranch Marketplace, 182 Ranch Dr, Milpitas, CA 95035",name:"Banana Leaf",coordinates:{lat:37.429166,lng:-121.920085},icon:"images/food.png",category:"restaurants"},{address:"5237 Stevens Creek Blvd Santa Clara, CA 95051",name:"Chromatic Coffee",coordinates:{lat:37.323991,lng:-121.994498},icon:"images/coffee.png",category:"coffee"}],yelpSuccessMessage:function(e,a,n,o,t,i){return'<div id="content"><h2 id="heading">'+e+'</h2><div id="description">Click the button for Yelp Reviews about <em><b>'+e+'</b></em><br><div id="yelp"><p><b>Address:</b> '+a+", "+n+'</p><p>Ratings: <img src="'+o+'" alt="ratings image"/></p><img src="'+t+'" alt="image of place"/><br><br><a href="'+i+'" target="_blank"><img src="images/yelp_review_btn_red.png"/></a></div></div></div>'},yelpErrorMessage:function(e){return'<div id="content><h2 id="heading">'+e+'</h2><div id="description"><h2>Woops!</h2><p>Could not fetch information from Yelp for <em><b>'+e+"</b></em></p><p>Please check your internet connect and try again later.</p></div></div>"}},a=function(){$(".menuIcon").click(function(e){e.preventDefault(),$("#wrapper").toggleClass("toggled"),$("input").focus()}),$("button").click(function(){$("input").focus()});var a=new google.maps.Map(document.getElementById("map"),e.initialMap);infoWindow=new google.maps.InfoWindow({content:"",maxWidth:250}),ko.applyBindings(new n(a))},n=function(a){var n=this;n.map=a,n.inputString=ko.observable(""),n.locations=ko.observableArray([]),n.markers=[],n.compare=function(e,a){return e.name<a.name?-1:e.name>a.name?1:0},e.mapPlaces.sort(n.compare),e.mapPlaces.forEach(function(e){e.clicked=ko.observable(!1),n.locations().push(e)}),n.bounds=new google.maps.LatLngBounds,n.addMapMarkers=function(){n.locations().forEach(function(e){e.map=n.map,e.marker=new google.maps.Marker({map:e.map,position:e.coordinates,animation:google.maps.Animation.DROP,title:e.name,icon:e.icon}),n.getYelpReviews(e),n.markers.push(e.marker),n.bounds.extend(new google.maps.LatLng(e.coordinates)),e.marker.addListener("click",function(){n.displayPlaceInfo(e)})}),n.map.fitBounds(n.bounds),n.map.setCenter(n.bounds.getCenter())},n.getYelpReviews=function(a){var n={consumerKey:"XYBDe1H6mOgNCWXGfiJZaQ",consumerSecret:"AGCTqcGXajIqjABfSn4LXk4yfcY",accessToken:"2mLbAaofW3euUQE4xYSIxfveWAbKVPuU",accessTokenSecret:"BLuRQ1aZZPjgroD3tPrnMSS-RhQ",serviceProvider:{signatureMethod:"HMAC-SHA1"}},o={consumerSecret:n.consumerSecret,tokenSecret:n.accessTokenSecret},t=[];t.push(["term",a.name]),t.push(["location",a.address]),t.push(["sort",1]),t.push(["category_filter",a.category]),t.push(["callback","cb"]),t.push(["oauth_consumer_key",n.consumerKey]),t.push(["oauth_consumer_secret",n.consumerSecret]),t.push(["oauth_token",n.accessToken]),t.push(["oauth_signature_method","HMAC-SHA1"]);var i={action:"http://api.yelp.com/v2/search",method:"GET",parameters:t};OAuth.setTimestampAndNonce(i),OAuth.SignatureMethod.sign(i,o);var s=OAuth.getParameterMap(i.parameters);s.oauth_signature=OAuth.percentEncode(s.oauth_signature),$.ajax({url:i.action,data:s,cache:!0,dataType:"jsonp",timeout:2e3,error:function(){var n=e.yelpErrorMessage(a.name);a.infowindow=new google.maps.InfoWindow({content:n})}}).done(function(n){var o=n.businesses[0].location.display_address[0],t=n.businesses[0].location.display_address[1],i=n.businesses[0].rating_img_url,s=n.businesses[0].image_url,r=n.businesses[0].url,c=e.yelpSuccessMessage(a.name,o,t,i,s,r);a.infowindow=new google.maps.InfoWindow({content:c})})},n.addMapMarkers(),n.filterPlaces=function(a){n.locations.removeAll(),n.markers.forEach(function(e){e.setMap(null)}),n.markers=[];var o=n.inputString().toLowerCase();e.mapPlaces.forEach(function(e){(e.name.toLowerCase().indexOf(o)>=0||e.category.toLowerCase().indexOf(o)>=0)&&n.locations.push(e)}),n.addMapMarkers()},n.inputString.subscribe(n.filterPlaces),n.resetFilter=function(){n.inputString(""),e.mapPlaces.forEach(function(e){n.locations().push(e)}),n.bounds=new google.maps.LatLngBounds,n.locations().forEach(function(e){n.bounds.extend(new google.maps.LatLng(e.coordinates)),e.clicked(!1),e.marker.setAnimation(null),e.infowindow.close()}),n.map.fitBounds(n.bounds),n.map.setCenter(n.bounds.getCenter())},n.toggleBounce=function(e){null!==e.getAnimation()?e.setAnimation(null):e.setAnimation(google.maps.Animation.BOUNCE)},n.displayPlaceInfo=function(e){n.markers.forEach(function(a){a!=e.marker&&a.setAnimation(null)}),n.toggleBounce(e.marker),n.locations().forEach(function(a){a!=e&&a.clicked(!0)&&(a.clicked(!1),a.infowindow.close())}),e.clicked()===!0?(e.clicked(!1),e.infowindow.close()):(e.clicked(!0),e.infowindow.open(e.map,e.marker)),e.infowindow.addListener("closeclick",function(){e.clicked(!1),e.marker.setAnimation(null)}),e.map.panTo({lat:e.coordinates.lat+.1,lng:e.coordinates.lng})}};a()};